<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biztonságos Tippek</title>
    <!-- Tailwind CSS és Inter betűtípus -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn {
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #38bdf8; /* Cyan-400 */
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md mx-auto">
        <p id="app-status" class="text-center text-sm text-yellow-500 mb-4 h-5"></p>

        <!-- BEJELENTKEZÉS NÉZET -->
        <div id="login-view">
            <div class="card rounded-2xl p-8 shadow-2xl space-y-6">
                <h1 class="text-3xl font-bold text-center text-cyan-400">Biztonságos Tippek</h1>
                <p class="text-center text-gray-400">Jelentkezz be az e-mail címeddel.</p>
                <div>
                    <label for="login-email-input" class="block text-sm font-medium text-gray-300 mb-2">E-mail</label>
                    <input type="email" id="login-email-input" placeholder="neved@example.com / felhasznalo (Admin)" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                </div>
                <div>
                    <label for="login-password-input" class="block text-sm font-medium text-gray-300 mb-2">Jelszó</label>
                    <input type="password" id="login-password-input" placeholder="Jelszó" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                </div>
                <button id="login-btn" class="w-full btn bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center">
                    <span id="login-btn-text">Belépés</span>
                    <div id="login-spinner" class="loading-spinner hidden ml-3"></div>
                </button>
                <p id="login-message" class="text-center text-red-400 text-sm h-4"></p>
                <button id="to-register-btn" class="text-center w-full text-sm text-gray-400 hover:text-white">Nincs még fiókom? **Ingyenes csatlakozás!**</button>
            </div>
        </div>
        
        <!-- REGISZTRÁCIÓS NÉZET (rejtett) -->
        <div id="register-view" class="hidden">
            <div class="card rounded-2xl p-8 shadow-2xl space-y-6">
                <h1 class="text-3xl font-bold text-center text-green-400">Ingyenes Csatlakozás</h1>
                <p class="text-center text-gray-400">Készítsd el a fiókodat.</p>
                <input type="text" id="reg-name-input" placeholder="Név" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-green-500 focus:outline-none">
                <input type="email" id="reg-email-input" placeholder="E-mail cím" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-green-500 focus:outline-none">
                <input type="password" id="reg-password-input" placeholder="Jelszó (min. 6 karakter)" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-green-500 focus:outline-none">
                <button id="register-btn" class="w-full btn bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center">
                    <span id="register-btn-text">Regisztráció</span>
                    <div id="register-spinner" class="loading-spinner hidden ml-3"></div>
                </button>
                <p id="register-message" class="text-center text-red-400 text-sm h-4"></p>
                <button id="back-to-login-btn-reg" class="text-center w-full text-sm text-gray-400 hover:text-white">Vissza a bejelentkezéshez</button>
            </div>
        </div>

        <!-- FIZETÉSI NÉZET (rejtett) - ÚJ -->
        <div id="payment-view" class="hidden">
            <div class="card rounded-2xl p-8 shadow-2xl space-y-6">
                <h1 class="text-3xl font-bold text-center text-yellow-400">Csomag Aktiválása</h1>
                <p class="text-center text-gray-400">Fizess elő a "Biztonsági Csomagra", hogy lásd a tippeket.</p>
                
                <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 text-center space-y-4">
                    <h2 class="text-2xl font-semibold text-white">Biztonsági Csomag</h2>
                    <p class="text-4xl font-bold text-yellow-400">5990 Ft</p>
                    <p class="text-gray-400">1 hónapos hozzáférés</p>
                </div>

                <p class="text-sm text-gray-500 text-center">A gombra kattintva szimuláljuk a sikeres fizetést (pl. Revolut). Valódi fizetés nem történik.</p>

                <button id="pay-btn" class="w-full btn bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center">
                    <span id="pay-btn-text">Fizetés és Csomag Aktiválása</span>
                    <div id="pay-spinner" class="loading-spinner hidden ml-3"></div>
                </button>

                <button id="back-to-login-btn-pay" class="text-center w-full text-sm text-gray-400 hover:text-white">Kijelentkezés</button>
            </div>
        </div>


        <!-- FELHASZNÁLÓI VEZÉRLŐPULT (rejtett) -->
        <div id="dashboard-view" class="hidden">
             <div class="card rounded-2xl p-8 shadow-2xl space-y-6">
                 <div class="flex justify-between items-center mb-4">
                     <h1 class="text-2xl font-bold text-cyan-400">Biztonságos Tippek</h1>
                     <button id="user-logout-btn" class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Kilépés</button>
                 </div>
                 <p class="text-gray-400 text-sm">Üdvözöljük, <span id="user-name-display" class="font-bold text-white">Vendég</span>!</p>

                 <!-- FŐ TIPP SZEKCIÓ (Kép és Szöveg) -->
                 <div id="free-tip-section" class="space-y-4">
                     <h2 class="text-xl font-semibold text-center text-green-400">A nap kiemelt tippje</h2>
                     <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 text-center space-y-4">
                         <img id="free-tip-image" src="" alt="A kiemelt tipp illusztrációja" class="w-full h-auto max-h-48 object-cover rounded-lg border border-gray-700" onerror="this.style.display='none'">
                         <p id="free-tip-text" class="text-white text-lg font-medium">Betöltés alatt...</p>
                     </div>
                 </div>
                 <div class="border-t border-gray-700"></div>
                 <!-- EGYÉB TIPP KÁRTYÁK -->
                 <h2 class="text-xl font-semibold text-center text-cyan-400">További elemzések</h2>
                 <div id="user-cards-container" class="space-y-4 max-h-60 overflow-y-auto pr-2">
                     <p class="text-center text-gray-500">Nincsenek további tippek.</p>
                 </div>
             </div>
        </div>

        <!-- ADMIN NÉZET (rejtett) -->
        <div id="admin-view" class="hidden">
             <div class="card rounded-2xl p-8 shadow-2xl space-y-6">
                 <div class="flex justify-between items-center">
                     <h1 class="text-3xl font-bold text-orange-400">Admin Felület (Kép & Szöveg)</h1>
                     <button id="admin-logout-btn" class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Kilépés</button>
                 </div>
                 <p id="admin-message" class="text-center text-green-400 h-4"></p>
                 
                 <!-- KIEMELT TIPP BEÁLLÍTÁSA -->
                 <div class="space-y-4 p-4 bg-gray-800 rounded-lg border border-gray-700">
                     <h2 class="text-xl font-semibold text-green-400">Kiemelt tipp beállítása</h2>
                     <form id="free-tip-form" class="space-y-3">
                         <textarea id="free-tip-text-input" placeholder="A kiemelt tipp részletes szövege" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:ring-1 focus:ring-green-500 focus:outline-none h-24"></textarea>
                         <input type="text" id="free-tip-image-input" placeholder="Kép URL (pl. https://...)" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:ring-1 focus:ring-green-500 focus:outline-none">
                         <button type="submit" class="w-full btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded-md">Tipp mentése</button>
                     </form>
                 </div>
                 <!-- ÚJ KÁRTYA LÉTREHOZÁSA -->
                 <div class="space-y-4 p-4 bg-gray-800 rounded-lg border border-gray-700">
                     <h2 class="text-xl font-semibold text-cyan-400">Új elemzés/tipp kártya létrehozása</h2>
                     <form id="new-card-form" class="space-y-3">
                         <textarea id="card-text-input" placeholder="A tipp rövid szövege / összefoglaló" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:ring-1 focus:ring-cyan-500 focus:outline-none"></textarea>
                         <input type="text" id="card-image-input" placeholder="Kép URL (opcionális, pl. https://...)" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:ring-1 focus:ring-cyan-500 focus:outline-none">
                         <button type="submit" class="w-full btn bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 rounded-md">Kártya hozzáadása</button>
                     </form>
                 </div>
                 <!-- LÉTREHOZOTT KÁRTYÁK -->
                 <h2 class="text-xl font-semibold text-orange-400 mt-6">Aktuális Kártyák (törléshez)</h2>
                 <div id="cards-container" class="space-y-4 max-h-60 overflow-y-auto pr-2">
                     <!-- A dinamikusan generált kártyák helye -->
                 </div>
             </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, 
            createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,
            updateProfile // Hozzáadva a felhasználónév mentéséhez
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, onSnapshot, collection, query, getDocs, deleteDoc, orderBy 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // === GLOBÁLIS VÁLTOZÓK ÉS FIREBASE INICIALIZÁLÁS ===
        
        // ADMIN BELÉPÉSI ADATOK (Titkos felülírás az Ön kérésére)
        const ADMIN_EMAIL_OVERRIDE = "felhasznalo";
        const ADMIN_PASSWORD_OVERRIDE = "biztonság jelszo tippek";

        // CANVAS KÖRNYEZETI VÁLTOZÓK
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        let db, auth, userId = null;
        let isAuthReady = false;

        // Firebsae konfiguráció betöltése
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        
        // Firestore Collection Path-ok
        const FREE_TIP_DOC_PATH = `artifacts/${appId}/public/data/secure-tips/free_tip`;
        const CARD_TIPS_COLLECTION_PATH = `artifacts/${appId}/public/data/secure-tips`;

        // === DOM ELEMEK ===
        const appStatus = document.getElementById('app-status');
        // Nézetek
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');
        const paymentView = document.getElementById('payment-view'); // ÚJ
        const dashboardView = document.getElementById('dashboard-view');
        const adminView = document.getElementById('admin-view');

        // Login
        const loginEmailInput = document.getElementById('login-email-input');
        const loginPasswordInput = document.getElementById('login-password-input');
        const loginBtn = document.getElementById('login-btn');
        const loginBtnText = document.getElementById('login-btn-text');
        const loginSpinner = document.getElementById('login-spinner');
        const loginMessage = document.getElementById('login-message');
        const toRegisterBtn = document.getElementById('to-register-btn');

        // Register
        const regNameInput = document.getElementById('reg-name-input');
        const regEmailInput = document.getElementById('reg-email-input');
        const regPasswordInput = document.getElementById('reg-password-input');
        const registerBtn = document.getElementById('register-btn');
        const registerBtnText = document.getElementById('register-btn-text');
        const registerSpinner = document.getElementById('register-spinner');
        const registerMessage = document.getElementById('register-message');
        const backToLoginBtnReg = document.getElementById('back-to-login-btn-reg');
        
        // Payment (ÚJ)
        const payBtn = document.getElementById('pay-btn');
        const payBtnText = document.getElementById('pay-btn-text');
        const paySpinner = document.getElementById('pay-spinner');
        const backToLoginBtnPay = document.getElementById('back-to-login-btn-pay');

        // Dashboard
        const userNameDisplay = document.getElementById('user-name-display');
        const userLogoutBtn = document.getElementById('user-logout-btn');
        const freeTipImage = document.getElementById('free-tip-image');
        const freeTipText = document.getElementById('free-tip-text');
        const userCardsContainer = document.getElementById('user-cards-container');

        // Admin
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        const adminMessage = document.getElementById('admin-message');
        const freeTipForm = document.getElementById('free-tip-form');
        const freeTipTextInput = document.getElementById('free-tip-text-input');
        const freeTipImageInput = document.getElementById('free-tip-image-input');
        const newCardForm = document.getElementById('new-card-form');
        const cardTextInput = document.getElementById('card-text-input');
        const cardImageInput = document.getElementById('card-image-input');
        const cardsContainer = document.getElementById('cards-container');


        // === SEGÉDFÜGGVÉNYEK ===

        function showView(viewToShow) {
            // Elrejti az összes nézetet, majd mutatja a kért nézetet
            [loginView, registerView, dashboardView, adminView, paymentView].forEach(view => view.classList.add('hidden')); // Bővítve paymentView-val
            viewToShow.classList.remove('hidden');
        }

        function showMessage(element, text, isError = false) {
            element.textContent = text;
            element.className = `text-center text-sm h-4 ${isError ? 'text-red-400' : 'text-green-400'}`;
            setTimeout(() => { element.textContent = ''; }, 4000);
        }

        function setButtonLoading(button, textElement, spinnerElement, isLoading) {
            button.disabled = isLoading;
            textElement.classList.toggle('hidden', isLoading);
            spinnerElement.classList.toggle('hidden', !isLoading);
        }

        // === FIREBASE FÜGGVÉNYEK ===

        async function initializeFirebase() {
            if (!firebaseConfig) {
                appStatus.textContent = "Hiba: A Firebase konfiguráció hiányzik.";
                return;
            }
            
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Bejelentkezés a tokennel, ha van, különben anonim
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Auth állapot figyelése
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        // A megjelenített név frissítése, a displayName előnyben részesítésével
                        userNameDisplay.textContent = user.displayName || user.email || 'Vendég';
                    } else {
                        userId = null;
                    }
                    isAuthReady = true;
                    startListeners(); // Adatbázis figyelés indítása
                    if (!user || user.isAnonymous) {
                        showView(loginView); // Alapértelmezett nézet
                    }
                });

                appStatus.textContent = "Sikeres kapcsolat a szerverrel.";

            } catch (error) {
                console.error("Firebase hiba:", error);
                appStatus.textContent = `Hiba a Firebase inicializálásakor: ${error.code || error.message}`;
                showView(loginView);
            }
        }
        
        function startListeners() {
            if (!db || !isAuthReady) return;

            // 1. Kiemelt tipp figyelése (Free Tip)
            onSnapshot(doc(db, FREE_TIP_DOC_PATH), (docSnap) => {
                const data = docSnap.data() || { text: 'Nincs beállított kiemelt tipp.', imageUrl: '' };
                freeTipText.textContent = data.text;
                freeTipImage.src = data.imageUrl;
                freeTipImage.style.display = data.imageUrl ? 'block' : 'none';

                // Admin mezők frissítése
                freeTipTextInput.value = data.text;
                freeTipImageInput.value = data.imageUrl;
            });

            // 2. Tipp kártyák figyelése
            // A CARD_TIPS_COLLECTION_PATH (5 szegmens) a gyűjtemény útvonala.
            const q = query(collection(db, CARD_TIPS_COLLECTION_PATH));

            onSnapshot(q, (snapshot) => {
                // Lekérdezés után manuálisan rendezzük időbélyeg szerint, ha szükséges
                const tips = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // A Firestore lekérdezésben nem használunk orderBy-t indexelési hiba miatt,
                // ezért itt rendezünk (ha van timestamp)
                tips.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); 
                
                renderUserCards(tips);
                renderAdminCards(tips);
            });
        }


        // === ADMIN / UI RENDER FÜGGVÉNYEK ===

        function renderAdminCards(tips) {
            cardsContainer.innerHTML = tips.length === 0 ? '<p class="text-center text-gray-500">Még nincs létrehozott kártya.</p>' : '';
            tips.forEach(card => {
                cardsContainer.innerHTML += `
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex justify-between items-start">
                        <div class="flex-1 pr-4">
                            <p class="text-sm text-gray-400 mb-2">${card.imageUrl ? 'Kép van csatolva' : 'Nincs kép'}</p>
                            <p class="text-white text-md overflow-hidden max-h-16">${card.text.substring(0, 100)}...</p>
                        </div>
                        <button onclick="deleteTipCard('${card.id}')" class="text-xs text-red-500 hover:text-red-400 mt-1 flex-shrink-0">Törlés</button>
                    </div>`;
            });
        }
        
        function renderUserCards(tips) {
            userCardsContainer.innerHTML = tips.length === 0 ? '<p class="text-center text-gray-500">Nincsenek további elemzések.</p>' : '';
            tips.forEach(card => {
                userCardsContainer.innerHTML += `
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4">
                        ${card.imageUrl ? `<img src="${card.imageUrl}" alt="Illusztráció" class="w-16 h-16 object-cover rounded-md flex-shrink-0" onerror="this.src='https://placehold.co/64x64/2d3748/a0aec0?text=K%C3%A9p'">` : ''}
                        <div class="flex-1 text-center md:text-left">
                            <p class="text-sm text-white">${card.text}</p>
                        </div>
                    </div>`;
            });
        }

        window.deleteTipCard = async function(docId) {
            if (!db) return;
            try {
                await deleteDoc(doc(db, CARD_TIPS_COLLECTION_PATH, docId));
                showMessage(adminMessage, 'Kártya sikeresen törölve!');
            } catch (e) {
                showMessage(adminMessage, 'Hiba a törlés során: ' + e.message, true);
            }
        }

        // === ESEMÉNYKEZELŐK ===

        // Nézetváltók
        toRegisterBtn.addEventListener('click', () => showView(registerView));
        backToLoginBtnReg.addEventListener('click', () => showView(loginView));
        
        // ÚJ: Vissza a loginhez a fizetési oldalról (kijelentkezés)
        backToLoginBtnPay.addEventListener('click', async () => {
             await signOut(auth);
             showView(loginView);
        });

        // Bejelentkezés
        loginBtn.addEventListener('click', async () => {
            loginMessage.textContent = '';
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value;

            if (!email || !password) {
                showMessage(loginMessage, 'Töltse ki mindkét mezőt.', true);
                return;
            }

            // ADMIN FELÜLÍRÁS (Titkos belépés)
            if (email === ADMIN_EMAIL_OVERRIDE && password === ADMIN_PASSWORD_OVERRIDE) {
                showView(adminView);
                return;
            }

            setButtonLoading(loginBtn, loginBtnText, loginSpinner, true);
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // MÓDOSÍTVA: Irányítás a fizetési oldalra
                showView(paymentView); 
            } catch (error) {
                showMessage(loginMessage, 'Bejelentkezési hiba: ' + (error.message.includes('auth/invalid-credential') ? 'Érvénytelen e-mail vagy jelszó.' : error.message), true);
            } finally {
                setButtonLoading(loginBtn, loginBtnText, loginSpinner, false);
            }
        });

        // Regisztráció
        registerBtn.addEventListener('click', async () => {
            registerMessage.textContent = '';
            const name = regNameInput.value.trim();
            const email = regEmailInput.value.trim();
            const password = regPasswordInput.value;

            if (!name || !email || password.length < 6) {
                showMessage(registerMessage, 'Kérlek, töltsd ki az összes mezőt (jelszó min. 6).', true);
                return;
            }

            setButtonLoading(registerBtn, registerBtnText, registerSpinner, true);

            try {
                // Felhasználó létrehozása
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Felhasználónév beállítása
                await updateProfile(userCredential.user, { displayName: name });
                
                // MÓDOSÍTVA: A felhasználó a login oldalra kerül, hogy bejelentkezzen és lássa a fizetési oldalt
                showMessage(loginMessage, 'Sikeres regisztráció! Lépj be a fiókoddal.', false);
                showView(loginView);
            } catch (error) {
                console.error("Registration Error:", error);
                let msg = 'Regisztrációs hiba. Próbáld újra.';
                if (error.code === 'auth/email-already-in-use') {
                    msg = 'Ez az e-mail cím már használatban van.';
                } else if (error.code === 'auth/weak-password') {
                    msg = 'A jelszónak legalább 6 karakter hosszúnak kell lennie.';
                } else if (error.code === 'auth/invalid-email') {
                    msg = 'Érvénytelen e-mail cím formátum.';
                }
                showMessage(registerMessage, msg, true);
            } finally {
                setButtonLoading(registerBtn, registerBtnText, registerSpinner, false);
            }
        });

        // ÚJ: Fizetés szimulálása
        payBtn.addEventListener('click', async () => {
            setButtonLoading(payBtn, payBtnText, paySpinner, true);
            
            // Itt lenne a valódi fizetési logika (pl. Revolut API hívás)
            // Mi most csak szimulálunk egy rövid várakozást
            await new Promise(resolve => setTimeout(resolve, 1500)); 
            
            // Sikeres "fizetés" után irányítás a főoldalra
            showView(dashboardView);
            setButtonLoading(payBtn, payBtnText, paySpinner, false);
        });

        // Kijelentkezés
        userLogoutBtn.addEventListener('click', async () => {
            await signOut(auth);
            showView(loginView);
        });
        adminLogoutBtn.addEventListener('click', async () => {
            // Az admin felülírás miatt egyszerűen csak a bejelentkezési oldalra visz
            // Ha az admin Firebase fiókkal lépne be, itt is signOut kellene
            showView(loginView);
        });

        // Admin: Kiemelt tipp mentése
        freeTipForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!db) return;

            const tipText = freeTipTextInput.value.trim();
            const imageUrl = freeTipImageInput.value.trim();

            try {
                await setDoc(doc(db, FREE_TIP_DOC_PATH), { 
                    text: tipText || 'Nincs beállított kiemelt tipp.', 
                    imageUrl: imageUrl,
                    timestamp: Date.now()
                });
                showMessage(adminMessage, 'Kiemelt tipp sikeresen mentve!');
            } catch (e) {
                showMessage(adminMessage, 'Hiba a mentés során: ' + e.message, true);
            }
        });

        // Admin: Új tipp kártya hozzáadása
        newCardForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!db) return;

            const tipText = cardTextInput.value.trim();
            const imageUrl = cardImageInput.value.trim();
            
            if (!tipText) {
                showMessage(adminMessage, 'A tipp szövege kötelező!', true);
                return;
            }

            try {
                // setDoc és doc(collection(...)) kombinációja új, egyedi ID-s dokumentumot hoz létre
                await setDoc(doc(collection(db, CARD_TIPS_COLLECTION_PATH)), {
                    text: tipText, 
                    imageUrl: imageUrl,
                    timestamp: Date.now()
                });
                showMessage(adminMessage, 'Új kártya sikeresen hozzáadva!');
                newCardForm.reset();
            } catch (e) {
                showMessage(adminMessage, 'Hiba a hozzáadás során: ' + e.message, true);
            }
        });

        // === INDÍTÁS ===
        initializeFirebase();
    </script>
</body>
</html>
