<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odds Minta Elemző</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #e5e7eb; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); }
        .input-field { background-color: #374151; border-color: #4b5563; }
        .input-field:focus { background-color: #4b5563; border-color: #38bdf8; ring: 0; }
        .card { background-color: #1f2937; border: 1px solid #374151; }
        .loader { width: 24px; height: 24px; border: 3px solid #4b5563; border-bottom-color: #38bdf8; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-8">

    <main class="max-w-6xl mx-auto space-y-8">
        <div>
            <h1 class="text-3xl md:text-4xl font-bold text-sky-400">Odds Minta Elemző</h1>
            <p class="text-slate-400 mt-1">Figyeld meg a mintákat, fedezd fel az összefüggéseket.</p>
        </div>

        <!-- Data Input Section -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold mb-4 text-white">1. Adatok Rögzítése</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">Főpiaci Oddsok (1X2)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="number" step="0.01" min="1" id="home-odd-input" placeholder="Hazai (1)" class="input-field w-full p-2 rounded-lg" required>
                        <input type="number" step="0.01" min="1" id="draw-odd-input" placeholder="Döntetlen (X)" class="input-field w-full p-2 rounded-lg" required>
                        <input type="number" step="0.01" min="1" id="away-odd-input" placeholder="Vendég (2)" class="input-field w-full p-2 rounded-lg" required>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">További Piacok</h3>
                     <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <input type="number" step="0.01" min="1" id="over-25-odd-input" placeholder="Over 2.5" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="under-25-odd-input" placeholder="Under 2.5" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="btts-yes-odd-input" placeholder="BTTS Igen" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="btts-no-odd-input" placeholder="BTTS Nem" class="input-field w-full p-2 rounded-lg">
                    </div>
                </div>
                 <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">Végeredmény</h3>
                    <div class="flex items-center gap-4">
                        <input type="number" min="0" id="home-score-input" placeholder="Hazai gól" class="input-field w-full p-2 rounded-lg" required>
                        <input type="number" min="0" id="away-score-input" placeholder="Vendég gól" class="input-field w-full p-2 rounded-lg" required>
                         <button id="save-match-btn" class="btn bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded-lg w-full md:w-auto">Meccs Mentése</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Analysis Section -->
        <div class="card p-6 rounded-xl">
             <h2 class="text-xl font-semibold mb-4 text-white">2. Minta Elemzés</h2>
             <p class="text-sm text-slate-400 mb-4">Írd be a vizsgálni kívánt oddsokat a fenti mezőkbe (az eredmény nem szükséges), majd kattints az elemzés gombra.</p>
             <button id="run-analysis-btn" class="btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg w-full">Elemzés Futtatása</button>
             <div id="analysis-output" class="mt-6"></div>
        </div>

        <!-- Database Section -->
        <div class="card p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-white">Rögzített Meccsek Adatbázisa</h2>
                <button id="clear-db-btn" class="btn bg-red-800 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg text-xs">Adatbázis Törlése</button>
            </div>
            <div id="log-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                <!-- Log items will be injected here -->
            </div>
        </div>

    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- UTILITY FUNCTIONS ---
    const parseSafeFloat = (str) => {
        if (typeof str !== 'string' || str.trim() === '') return NaN;
        return parseFloat(str.replace(',', '.'));
    };
    
    // --- UI ELEMENTS ---
    const elements = {
        homeOdd: document.getElementById('home-odd-input'),
        drawOdd: document.getElementById('draw-odd-input'),
        awayOdd: document.getElementById('away-odd-input'),
        over25Odd: document.getElementById('over-25-odd-input'),
        under25Odd: document.getElementById('under-25-odd-input'),
        bttsYesOdd: document.getElementById('btts-yes-odd-input'),
        bttsNoOdd: document.getElementById('btts-no-odd-input'),
        homeScore: document.getElementById('home-score-input'),
        awayScore: document.getElementById('away-score-input'),
        saveMatchBtn: document.getElementById('save-match-btn'),
        runAnalysisBtn: document.getElementById('run-analysis-btn'),
        clearDbBtn: document.getElementById('clear-db-btn'),
        logList: document.getElementById('log-list'),
        analysisOutput: document.getElementById('analysis-output'),
    };

    // --- DATA MANAGEMENT ---
    let matchLogs = [];

    const loadData = () => {
        const storedLogs = localStorage.getItem('oddsPatternLogs');
        matchLogs = storedLogs ? JSON.parse(storedLogs) : [];
        renderLogs();
    };

    const saveData = () => {
        localStorage.setItem('oddsPatternLogs', JSON.stringify(matchLogs));
    };

    // --- UI RENDERING ---
    const renderLogs = () => {
        elements.logList.innerHTML = matchLogs.length === 0 
            ? '<p class="text-slate-500 text-center">Nincsenek rögzített meccsek.</p>'
            : matchLogs.map(log => `
                <div class="bg-gray-800 p-3 rounded-lg flex flex-col md:flex-row justify-between items-center gap-2 text-sm">
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <span class="px-2 py-1 bg-slate-700 rounded">1: <strong>${log.odds.home.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">X: <strong>${log.odds.draw.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">2: <strong>${log.odds.away.toFixed(2)}</strong></span>
                    </div>
                    <div class="text-2xl font-bold text-sky-400">
                        ${log.score.home} - ${log.score.away}
                    </div>
                </div>
            `).join('');
    };

    // --- CORE LOGIC ---
    const handleSaveMatch = () => {
        const odds = {
            home: parseSafeFloat(elements.homeOdd.value),
            draw: parseSafeFloat(elements.drawOdd.value),
            away: parseSafeFloat(elements.awayOdd.value),
            over25: parseSafeFloat(elements.over25Odd.value),
            under25: parseSafeFloat(elements.under25Odd.value),
            bttsYes: parseSafeFloat(elements.bttsYesOdd.value),
            bttsNo: parseSafeFloat(elements.bttsNoOdd.value),
        };
        const score = {
            home: parseInt(elements.homeScore.value, 10),
            away: parseInt(elements.awayScore.value, 10),
        };

        if (isNaN(odds.home) || isNaN(odds.draw) || isNaN(odds.away) || isNaN(score.home) || isNaN(score.away)) {
            alert('Kérlek töltsd ki a kötelező odds és eredmény mezőket!');
            return;
        }

        matchLogs.unshift({ id: Date.now(), odds, score });
        saveData();
        renderLogs();
        
        // Clear score fields after saving
        elements.homeScore.value = '';
        elements.awayScore.value = '';
    };

    const handleRunAnalysis = () => {
        const targetOdds = {
            home: parseSafeFloat(elements.homeOdd.value),
            draw: parseSafeFloat(elements.drawOdd.value),
            away: parseSafeFloat(elements.awayOdd.value),
        };

        if (isNaN(targetOdds.home) || isNaN(targetOdds.draw) || isNaN(targetOdds.away)) {
            elements.analysisOutput.innerHTML = `<p class="text-yellow-400">Az elemzéshez add meg legalább a főpiaci (1X2) oddsokat.</p>`;
            return;
        }
        
        elements.analysisOutput.innerHTML = '<div class="flex justify-center items-center gap-2"><div class="loader"></div><p>Elemzés...</p></div>';

        setTimeout(() => { // Simulate processing
            const SIMILARITY_RANGES = {
                home_low: 0.05, // for odds < 2.0
                home_high: 0.1,  // for odds >= 2.0
                draw: 0.2,
                away_low: 0.5,   // for odds < 8.0
                away_high: 1.0,  // for odds >= 8.0
            };

            const similarMatches = matchLogs.filter(log => {
                const homeRange = log.odds.home < 2.0 ? SIMILARITY_RANGES.home_low : SIMILARITY_RANGES.home_high;
                const awayRange = log.odds.away < 8.0 ? SIMILARITY_RANGES.away_low : SIMILARITY_RANGES.away_high;
                
                return (
                    Math.abs(log.odds.home - targetOdds.home) <= homeRange &&
                    Math.abs(log.odds.draw - targetOdds.draw) <= SIMILARITY_RANGES.draw &&
                    Math.abs(log.odds.away - targetOdds.away) <= awayRange
                );
            });

            if (similarMatches.length < 3) {
                elements.analysisOutput.innerHTML = `<p class="text-slate-400">Nincs elegendő (min. 3) hasonló meccs az adatbázisban a megbízható elemzéshez. Találat: ${similarMatches.length} db.</p>`;
                return;
            }

            const stats = {
                homeWin: 0, draw: 0, awayWin: 0,
                over25: 0, under25: 0,
                bttsYes: 0, bttsNo: 0,
                scores: {}
            };

            similarMatches.forEach(match => {
                // 1X2
                if (match.score.home > match.score.away) stats.homeWin++;
                else if (match.score.home < match.score.away) stats.awayWin++;
                else stats.draw++;
                
                // Over/Under
                if (match.score.home + match.score.away > 2.5) stats.over25++;
                else stats.under25++;

                // BTTS
                if (match.score.home > 0 && match.score.away > 0) stats.bttsYes++;
                else stats.bttsNo++;
                
                // Scorelines
                const scoreKey = `${match.score.home}-${match.score.away}`;
                stats.scores[scoreKey] = (stats.scores[scoreKey] || 0) + 1;
            });

            const total = similarMatches.length;
            const toPercent = (val) => ((val / total) * 100).toFixed(0);

            const mostCommonScores = Object.entries(stats.scores)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 2)
                .map(([score, count]) => `${score} (${toPercent(count)}%)`)
                .join(', ');

            elements.analysisOutput.innerHTML = `
                <div class="space-y-4 p-4 bg-gray-900 rounded-lg">
                    <p class="text-sm">Az adatbázisban <strong>${total}</strong>, a megadott mintához hasonló meccset találtam.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                             <h4 class="font-semibold text-sky-400">Fő kimenetelek</h4>
                             <p class="flex justify-between"><span>Hazai győzelem:</span> <strong>${toPercent(stats.homeWin)}%</strong> (${stats.homeWin}/${total})</p>
                             <p class="flex justify-between"><span>Döntetlen:</span> <strong>${toPercent(stats.draw)}%</strong> (${stats.draw}/${total})</p>
                             <p class="flex justify-between"><span>Vendég győzelem:</span> <strong>${toPercent(stats.awayWin)}%</strong> (${stats.awayWin}/${total})</p>
                        </div>
                        <div class="space-y-2">
                             <h4 class="font-semibold text-sky-400">Gólok</h4>
                             <p class="flex justify-between"><span>Over 2.5:</span> <strong>${toPercent(stats.over25)}%</strong> (${stats.over25}/${total})</p>
                             <p class="flex justify-between"><span>BTTS Igen:</span> <strong>${toPercent(stats.bttsYes)}%</strong> (${stats.bttsYes}/${total})</p>
                             <p class="flex justify-between"><span>Leggyakoribb eredmény(ek):</span> <strong>${mostCommonScores || 'N/A'}</strong></p>
                        </div>
                    </div>
                </div>
            `;

        }, 500);
    };

    // --- EVENT LISTENERS ---
    elements.saveMatchBtn.addEventListener('click', handleSaveMatch);
    elements.runAnalysisBtn.addEventListener('click', handleRunAnalysis);
    elements.clearDbBtn.addEventListener('click', () => {
        if (confirm('Biztosan törölni szeretnéd az összes rögzített meccset?')) {
            matchLogs = [];
            saveData();
            renderLogs();
            elements.analysisOutput.innerHTML = '';
        }
    });

    // --- INITIALIZATION ---
    loadData();
});
</script>

</body>
</html>
