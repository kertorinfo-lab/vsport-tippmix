<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odds Minta Elemző</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #e5e7eb; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); }
        .input-field { background-color: #374151; border-color: #4b5563; }
        .input-field:focus { background-color: #4b5563; border-color: #38bdf8; ring: 0; }
        .card { background-color: #1f2937; border: 1px solid #374151; }
        .loader { width: 24px; height: 24px; border: 3px solid #4b5563; border-bottom-color: #38bdf8; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-8">

    <main class="max-w-6xl mx-auto space-y-8">
        <div>
            <h1 class="text-3xl md:text-4xl font-bold text-sky-400">Odds Minta Elemző</h1>
            <p class="text-slate-400 mt-1">Figyeld meg a mintákat, fedezd fel az összefüggéseket.</p>
        </div>

        <!-- Data Input Section -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold mb-4 text-white">1. Adatok Rögzítése</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">Főpiaci Oddsok (1X2)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="number" step="0.01" min="1" id="home-odd-input" placeholder="Hazai (1)" class="input-field w-full p-2 rounded-lg" required>
                        <input type="number" step="0.01" min="1" id="draw-odd-input" placeholder="Döntetlen (X)" class="input-field w-full p-2 rounded-lg" required>
                        <input type="number" step="0.01" min="1" id="away-odd-input" placeholder="Vendég (2)" class="input-field w-full p-2 rounded-lg" required>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">További Piacok (Opcionális)</h3>
                     <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <input type="number" step="0.01" min="1" id="over-25-odd-input" placeholder="Over 2.5" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="under-25-odd-input" placeholder="Under 2.5" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="btts-yes-odd-input" placeholder="BTTS Igen" class="input-field w-full p-2 rounded-lg">
                        <input type="number" step="0.01" min="1" id="btts-no-odd-input" placeholder="BTTS Nem" class="input-field w-full p-2 rounded-lg">
                    </div>
                </div>
                 <div>
                    <h3 class="text-sm font-medium text-slate-300 mb-2">Végeredmény</h3>
                    <div class="flex items-center gap-4 flex-wrap">
                        <input type="number" min="0" id="home-score-input" placeholder="Hazai gól" class="input-field flex-grow p-2 rounded-lg" required>
                        <input type="number" min="0" id="away-score-input" placeholder="Vendég gól" class="input-field flex-grow p-2 rounded-lg" required>
                         <button id="save-match-btn" class="btn bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded-lg w-full md:w-auto">Meccs Mentése</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Analysis Section -->
        <div class="card p-6 rounded-xl">
             <h2 class="text-xl font-semibold mb-4 text-white">2. Minta Elemzés</h2>
             <p class="text-sm text-slate-400 mb-4">Írd be a vizsgálni kívánt oddsokat a fenti mezőkbe (az eredmény nem szükséges), majd kattints az elemzés gombra.</p>
             <button id="run-analysis-btn" class="btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg w-full">Elemzés Futtatása</button>
             <div id="analysis-output" class="mt-6"></div>
        </div>

        <!-- Database Section -->
        <div class="card p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-white">Rögzített Meccsek Adatbázisa</h2>
                <button id="clear-db-btn" class="btn bg-red-800 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg text-xs">Adatbázis Törlése</button>
            </div>
            <div id="log-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                <!-- Log items will be injected here -->
            </div>
        </div>

    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- UTILITY FUNCTIONS ---
    const parseSafeFloat = (str) => {
        if (typeof str !== 'string' || str.trim() === '') return NaN;
        return parseFloat(str.replace(',', '.'));
    };
    
    // --- UI ELEMENTS ---
    const elements = {
        homeOdd: document.getElementById('home-odd-input'),
        drawOdd: document.getElementById('draw-odd-input'),
        awayOdd: document.getElementById('away-odd-input'),
        over25Odd: document.getElementById('over-25-odd-input'),
        under25Odd: document.getElementById('under-25-odd-input'),
        bttsYesOdd: document.getElementById('btts-yes-odd-input'),
        bttsNoOdd: document.getElementById('btts-no-odd-input'),
        homeScore: document.getElementById('home-score-input'),
        awayScore: document.getElementById('away-score-input'),
        saveMatchBtn: document.getElementById('save-match-btn'),
        runAnalysisBtn: document.getElementById('run-analysis-btn'),
        clearDbBtn: document.getElementById('clear-db-btn'),
        logList: document.getElementById('log-list'),
        analysisOutput: document.getElementById('analysis-output'),
    };

    // --- DATA MANAGEMENT ---
    let matchLogs = [];

    const loadData = () => {
        const storedLogs = localStorage.getItem('oddsPatternLogs');
        matchLogs = storedLogs ? JSON.parse(storedLogs) : [];
        renderLogs();
    };

    const saveData = () => {
        localStorage.setItem('oddsPatternLogs', JSON.stringify(matchLogs));
    };

    // --- UI RENDERING ---
    const renderLogs = () => {
        elements.logList.innerHTML = matchLogs.length === 0 
            ? '<p class="text-slate-500 text-center">Nincsenek rögzített meccsek.</p>'
            : matchLogs.map(log => {
                const totalGoals = log.score.home + log.score.away;
                return `
                <div class="bg-gray-800 p-3 rounded-lg flex flex-col md:flex-row justify-between items-center gap-2 text-sm">
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <span class="px-2 py-1 bg-slate-700 rounded">1: <strong>${log.odds.home.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">X: <strong>${log.odds.draw.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">2: <strong>${log.odds.away.toFixed(2)}</strong></span>
                    </div>
                    <div class="text-2xl font-bold text-sky-400">
                        ${log.score.home} - ${log.score.away} <span class="text-sm font-normal text-slate-400">(${totalGoals} gól)</span>
                    </div>
                </div>
            `}).join('');
    };

    // --- CORE LOGIC ---
    const handleSaveMatch = () => {
        const odds = {
            home: parseSafeFloat(elements.homeOdd.value),
            draw: parseSafeFloat(elements.drawOdd.value),
            away: parseSafeFloat(elements.awayOdd.value),
            over25: parseSafeFloat(elements.over25Odd.value),
            under25: parseSafeFloat(elements.under25Odd.value),
            bttsYes: parseSafeFloat(elements.bttsYesOdd.value),
            bttsNo: parseSafeFloat(elements.bttsNoOdd.value),
        };
        const score = {
            home: parseInt(elements.homeScore.value, 10),
            away: parseInt(elements.awayScore.value, 10),
        };

        if (isNaN(odds.home) || isNaN(odds.draw) || isNaN(odds.away) || isNaN(score.home) || isNaN(score.away)) {
            alert('Kérlek töltsd ki a kötelező odds és eredmény mezőket!');
            return;
        }

        matchLogs.unshift({ id: Date.now(), odds, score });
        saveData();
        renderLogs();
        
        // Clear input fields after saving
        Object.values(elements).forEach(el => {
            if(el.tagName === 'INPUT' && el.id !== 'run-analysis-btn') el.value = '';
        });
    };

    const handleRunAnalysis = () => {
        const targetOdds = {
            home: parseSafeFloat(elements.homeOdd.value),
            draw: parseSafeFloat(elements.drawOdd.value),
            away: parseSafeFloat(elements.awayOdd.value),
        };

        if (isNaN(targetOdds.home) || isNaN(targetOdds.draw) || isNaN(targetOdds.away)) {
            elements.analysisOutput.innerHTML = `<p class="text-yellow-400">Az elemzéshez add meg legalább a főpiaci (1X2) oddsokat.</p>`;
            return;
        }
        
        elements.analysisOutput.innerHTML = '<div class="flex justify-center items-center gap-2"><div class="loader"></div><p>Elemzés...</p></div>';

        setTimeout(() => { // Simulate processing
            // 1. Determine Pattern
            const awayToHomeRatio = targetOdds.away / targetOdds.home;
            const drawToHomeRatio = targetOdds.draw / targetOdds.home;
            let pattern = 'Szoros meccs';
            if (awayToHomeRatio > 5 && drawToHomeRatio > 2.5) {
                pattern = 'Nagy favorit';
            }

            // 2. Filter Matches by Pattern
            const similarMatches = matchLogs.filter(log => {
                const logAwayToHome = log.odds.away / log.odds.home;
                const logDrawToHome = log.odds.draw / log.odds.home;
                let logPattern = 'Szoros meccs';
                if (logAwayToHome > 5 && logDrawToHome > 2.5) {
                    logPattern = 'Nagy favorit';
                }
                // Also check if the absolute home odd is somewhat close
                return logPattern === pattern && Math.abs(log.odds.home - targetOdds.home) < 0.2;
            });

            if (similarMatches.length < 3) {
                elements.analysisOutput.innerHTML = `<p class="text-slate-400">Nincs elegendő (min. 3) hasonló meccs az adatbázisban a megbízható elemzéshez. Találat: ${similarMatches.length} db.</p>`;
                return;
            }

            // 3. Calculate New Stats
            const stats = {
                total: similarMatches.length,
                homeWin_Over1_5: 0,
                homeWin_Under2_5: 0,
                awayWin_Under2_5: 0,
                homeGoals_1: 0,
                homeGoals_2: 0,
                totalHomeGoals: 0,
                totalAwayGoals: 0
            };

            similarMatches.forEach(match => {
                const totalGoals = match.score.home + match.score.away;
                // Combinations
                if (match.score.home > match.score.away) {
                    if (totalGoals > 1.5) stats.homeWin_Over1_5++;
                    if (totalGoals < 2.5) stats.homeWin_Under2_5++;
                }
                if (match.score.home < match.score.away) {
                    if (totalGoals < 2.5) stats.awayWin_Under2_5++;
                }
                // Home Goals
                if (match.score.home === 1) stats.homeGoals_1++;
                if (match.score.home === 2) stats.homeGoals_2++;
                // Averages
                stats.totalHomeGoals += match.score.home;
                stats.totalAwayGoals += match.score.away;
            });
            
            // 4. Render New UI
            const toPercent = (val) => ((val / stats.total) * 100).toFixed(0);
            const toAvg = (val) => (val / stats.total).toFixed(2);

            elements.analysisOutput.innerHTML = `
                <div class="space-y-4 p-4 bg-gray-900 rounded-lg">
                    <div class="text-center">
                        <p class="text-sm text-slate-400">Észlelt minta (${stats.total} meccs alapján):</p>
                        <p class="text-lg font-bold text-sky-400">${pattern === 'Nagy favorit' ? 'Nagy Favorit Mintázata' : 'Szoros Meccs Mintázata'}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                        <div class="space-y-3">
                             <h4 class="font-semibold text-white">Gyakori Kombinációk</h4>
                             <p class="flex justify-between"><span>Hazai nyer & Több mint 1.5 gól:</span> <strong>${toPercent(stats.homeWin_Over1_5)}%</strong></p>
                             <p class="flex justify-between"><span>Hazai nyer & Kevesebb mint 2.5 gól:</span> <strong>${toPercent(stats.homeWin_Under2_5)}%</strong></p>
                             <p class="flex justify-between"><span>Vendég nyer & Kevesebb mint 2.5 gól:</span> <strong class="text-yellow-400">${toPercent(stats.awayWin_Under2_5)}%</strong></p>
                        </div>
                        <div class="space-y-3">
                             <h4 class="font-semibold text-white">Gól Statisztikák</h4>
                             <p class="flex justify-between"><span>Hazai gólok (átlag):</span> <strong>${toAvg(stats.totalHomeGoals)}</strong></p>
                             <p class="flex justify-between"><span>Vendég gólok (átlag):</span> <strong>${toAvg(stats.totalAwayGoals)}</strong></p>
                             <p class="flex justify-between"><span>Hazai csapat 1 gólt szerez:</span> <strong>${toPercent(stats.homeGoals_1)}%</strong></p>
                        </div>
                    </div>
                </div>
            `;
        }, 500);
    };

    // --- EVENT LISTENERS ---
    elements.saveMatchBtn.addEventListener('click', handleSaveMatch);
    elements.runAnalysisBtn.addEventListener('click', handleRunAnalysis);
    elements.clearDbBtn.addEventListener('click', () => {
        if (confirm('Biztosan törölni szeretnéd az összes rögzített meccset?')) {
            matchLogs = [];
            saveData();
            renderLogs();
            elements.analysisOutput.innerHTML = '';
        }
    });

    // --- INITIALIZATION ---
    loadData();
});
</script>

</body>
</html>

