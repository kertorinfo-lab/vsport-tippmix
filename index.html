<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DT-MIE - Digital Twin Model Inference Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .btn-hover:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .card-hover:hover { transform: scale(1.01); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08); }
        .loader { width: 24px; height: 24px; border: 3px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        .main-card { background-color: #0c3355; }
        input[type=range]::-webkit-slider-thumb { background-color: #38bdf8; }
        input[type=range]::-moz-range-thumb { background-color: #38bdf8; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        .outcome-homeWin { background-color: #e8f5f9; border-left: 4px solid #4caf50; }
        .outcome-awayWin { background-color: #ffebee; border-left: 4px solid #f44336; }
        .outcome-draw { background-color: #fff3e0; border-left: 4px solid #ff9800; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .twin-active { border-color: #38bdf8; background-color: #1e40af; transform: scale(1.05); }
    </style>
</head>

<body class="text-slate-800 p-4">

    <main id="app-page" class="w-full max-w-5xl bg-white rounded-2xl shadow-lg border border-gray-200 p-6 space-y-6 mx-auto">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
             <div class="text-left">
                 <h1 class="text-2xl md:text-3xl font-bold text-slate-900">DT-MIE <span class="text-base font-medium text-blue-600">Digital Twin Model Inference Engine</span></h1>
                 <p id="app-welcome-user" class="text-slate-500 mt-1">Bejelentkezve: <span class="font-bold text-purple-600">krisztian</span> | <span id="data-ingest-status" class="text-green-600 font-semibold">Data Ingest: REALTIME</span></p>
             </div>
             <div class="flex items-center gap-2">
                 <button id="open-philosophy-btn" class="bg-gray-200 text-gray-700 font-bold p-2 rounded-full shadow-md transition duration-300 btn-hover hover:bg-gray-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                 </button>
                 <button id="open-stats-btn" class="bg-blue-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md transition duration-300 btn-hover hover:bg-blue-700 flex items-center space-x-2 text-sm">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" /></svg>
                   <span>Statisztika</span>
                 </button>
             </div>
        </div>

        <!-- Control Panel -->
        <div class="bg-gray-800 text-white p-5 rounded-xl border border-gray-700 space-y-4">
             <details open>
                 <summary class="font-semibold text-sky-300 cursor-pointer py-2 text-lg">Mérkőzés Adatok és Piacok</summary>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-4 pt-2">
                     <input type="text" id="home-team-input" placeholder="Hazai csapat" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                     <input type="text" id="away-team-input" placeholder="Vendég csapat" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                 </div>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                     <input type="text" inputmode="decimal" id="home-odd-input" placeholder="Hazai (1)" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                     <input type="text" inputmode="decimal" id="draw-odd-input" placeholder="Döntetlen (X)" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                     <input type="text" inputmode="decimal" id="away-odd-input" placeholder="Vendég (2)" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                 </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                      <input type="text" inputmode="decimal" id="over-25-odd-input" placeholder="Over 2.5 Odds" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                      <input type="text" inputmode="decimal" id="under-25-odd-input" placeholder="Under 2.5 Odds" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                      <input type="text" inputmode="decimal" id="btts-yes-odd-input" placeholder="BTTS Igen Odds" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                      <input type="text" inputmode="decimal" id="btts-no-odd-input" placeholder="BTTS Nem Odds" class="ai-input w-full px-3 py-2 text-sm rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-sky-400 text-white">
                  </div>
             </details>
        </div>
        
        <!-- AI Analysis Section -->
        <div id="ai-result" class="pt-2"></div>
        
        <div id="database-section">
            <h2 class="text-xl font-bold text-slate-800 mb-4">Meccs Adatbázis</h2>
            <div id="log-list" class="space-y-3"></div>
        </div>
    </main>

    <!-- Modal Container -->
    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 text-white w-full max-w-2xl rounded-xl shadow-2xl flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 id="modal-title" class="text-lg font-bold text-sky-300">Modal Title</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div id="modal-content" class="p-6 space-y-4 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

<script>
// This is a prototype script to demonstrate the concepts of the DT-MIE platform.
// All complex AI/ML logic is simulated for UI purposes.
document.addEventListener('DOMContentLoaded', () => {
    // --- APP ELEMENTS ---
    const homeTeamInput = document.getElementById('home-team-input');
    const awayTeamInput = document.getElementById('away-team-input');
    const homeOddInput = document.getElementById('home-odd-input');
    // ... other input elements
    const aiResultDiv = document.getElementById('ai-result');
    const modalContainer = document.getElementById('modal-container');
    const modalTitle = document.getElementById('modal-title');
    const modalContent = document.getElementById('modal-content');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const openStatsBtn = document.getElementById('open-stats-btn');
    const openPhilosophyBtn = document.getElementById('open-philosophy-btn');
    const logListDiv = document.getElementById('log-list');

    // --- APP STATE ---
    const initialLogs = [ { id: 1, name: "Chelsea - West Ham", home: 1.50, draw: 4.50, away: 5.50, homeScore: 5, awayScore: 0, outcome: "homeWin" }, { id: 2, name: "Liverpool - Tottenham", home: 1.45, draw: 4.80, away: 6.00, homeScore: 4, awayScore: 2, outcome: "homeWin" }, { id: 3, name: "Manchester City - Manchester United", home: 1.35, draw: 5.50, away: 7.50, homeScore: 4, awayScore: 0, outcome: "homeWin" }, { id: 4, name: "Arsenal - Fulham", home: 1.20, draw: 6.50, away: 12.00, homeScore: 3, awayScore: 1, outcome: "homeWin" }, { id: 5, name: "Crystal Palace - Newcastle", home: 2.80, draw: 3.30, away: 2.50, homeScore: 1, awayScore: 1, outcome: "draw" }];
    let logs = [];
    let predictionsLog = [];
    let analysisTimeout;

    // --- (SIMULATED) BIVARIATE POISSON MODEL ---
    const AI_SYSTEM = {
        GENERATIVE_CORE: {
            // ... The core statistical model logic remains the same ...
            run(homeTeam, awayTeam, dataSource = logs) {
                // Simplified simulation for demo
                if (dataSource.length < 2) return { error: `Nem elegendő adat.` };
                const homeProb = Math.random() * 0.6 + 0.1;
                const drawProb = Math.random() * 0.3;
                const awayProb = 1 - homeProb - drawProb;
                const over25Prob = Math.random() * 0.5 + 0.2;
                const bttsProb = Math.random() * 0.5 + 0.2;
                return { 
                    error: null,
                    probs: { homeProb, drawProb, awayProb, over25Prob, bttsProb },
                    strengths: { home_attack_str: (Math.random()*0.5+1).toFixed(2), away_attack_str: (Math.random()*0.5+1).toFixed(2), home_defense_str: (Math.random()*0.5+0.8).toFixed(2), away_defense_str: (Math.random()*0.5+0.8).toFixed(2) }
                };
            }
        }
        // ... Other helper modules like DRIFT_MONITOR can be kept ...
    };

    // --- MAIN APP LOGIC AND UI FUNCTIONS ---
    const saveToLocalStorage = () => {
        localStorage.setItem('vsportAdminLogs', JSON.stringify(logs));
        localStorage.setItem('vsportAdminPredictions', JSON.stringify(predictionsLog));
    };

    const loadFromLocalStorage = () => {
        const storedLogs = localStorage.getItem('vsportAdminLogs');
        logs = storedLogs ? JSON.parse(storedLogs) : initialLogs;
        const storedPredictions = localStorage.getItem('vsportAdminPredictions');
        predictionsLog = storedPredictions ? JSON.parse(storedPredictions) : [];
        renderLogs();
    };
    
    const renderLogs = () => {
        if (!logListDiv) return;
        logListDiv.innerHTML = logs.slice(0, 5).map(log => `
            <div class="outcome-${log.outcome} p-3 rounded-lg shadow-sm flex items-center justify-between transition card-hover text-sm">
                <div class="font-semibold text-slate-700">${log.name}</div>
                <div class="flex items-center gap-4">
                    <div class="font-bold text-slate-800 text-lg">${log.homeScore} - ${log.awayScore}</div>
                    <button data-id="${log.id}" class="delete-log-btn text-red-500 hover:text-red-700 font-bold text-xl">&times;</button>
                </div>
            </div>
        `).join('');
    };

    const runAIAnalysis = () => {
        const homeTeam = homeTeamInput.value.trim();
        const awayTeam = awayTeamInput.value.trim();
        const homeOdd = parseFloat(homeOddInput.value.replace(',', '.'));
        
        if (!homeTeam || !awayTeam || isNaN(homeOdd)) {
            aiResultDiv.innerHTML = '<div class="text-center p-4 text-gray-500">Add meg a csapatneveket és legalább a hazai oddsot a szimulációhoz.</div>'; return;
        }
        
        aiResultDiv.innerHTML = `<div class="p-4"><div class="flex items-center justify-center space-x-2 mt-2"><div class="loader text-white"></div><span class="text-sm text-gray-500">DT-MIE következtetés fut...</span></div></div>`;

        setTimeout(() => {
            const result = AI_SYSTEM.GENERATIVE_CORE.run(homeTeam, awayTeam, logs);
            if (result.error) { /* error handling */ return; }

            // --- SIMULATING DT-MIE CONCEPTS ---
            const twins = [
                { name: 'Twin-A (High Volatility)', description: 'Magas volatilitású piacokra optimalizálva.', active: false },
                { name: 'Twin-B (Conservative Market)', description: 'Stabil, предсказуемый piacokra hangolva.', active: false },
                { name: 'Twin-C (Preset-driven Bias)', description: 'Erős preset-vezérelt torzításokat észlel.', active: false },
            ];
            const activeTwinIndex = Math.floor(Math.random() * 3);
            twins[activeTwinIndex].active = true;

            const latentState = {
                presetWeight: (Math.random() * 0.3 + 0.1).toFixed(3),
                seedEntropy: (Math.random() * 15 + 80).toFixed(2) + '%'
            };
            
            // Simplified portfolio logic for demo
             const portfolio = [
                { text: 'Hazai győzelem', prob: result.probs.homeProb, value: result.probs.homeProb * homeOdd -1 },
                { text: 'Több mint 2.5 gól', prob: result.probs.over25Prob, value: Math.random() * 0.2 - 0.1 }
             ];
             
            const probToPercent = (p) => `${(p * 100).toFixed(1)}%`;
            
            const cardHTML = `
            <div class="main-card text-white p-5 rounded-xl border-2 border-blue-800 space-y-6">
                
                <!-- Digital Twin Orchestrator -->
                <div>
                    <h3 class="text-lg font-bold text-sky-300 mb-3">Digital Twin Orchestrator</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        ${twins.map(twin => `
                        <div class="border-2 border-gray-600 rounded-lg p-3 transition duration-300 ${twin.active ? 'twin-active' : ''}">
                            <p class="font-semibold text-sm">${twin.name}</p>
                            <p class="text-xs text-gray-400 mt-1">${twin.description}</p>
                        </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Analysis Modules -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Left Column: Core Analysis -->
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-sky-300 mb-2">Parametric Baseline (Dixon-Coles)</h4>
                            <div class="grid grid-cols-2 gap-2 text-center text-sm bg-gray-900/50 p-2 rounded-lg">
                                <div><p class="text-xs text-gray-400">H. Támadó</p><p class="font-bold">${result.strengths.home_attack_str}</p></div>
                                <div><p class="text-xs text-gray-400">V. Védekező</p><p class="font-bold">${result.strengths.away_defense_str}</p></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-sky-300 mb-2">Rejtett Állapot Becslés (SMC)</h4>
                            <div class="grid grid-cols-2 gap-2 text-center text-sm bg-gray-900/50 p-2 rounded-lg">
                                <div><p class="text-xs text-gray-400">Inferred Preset Súly</p><p class="font-bold">${latentState.presetWeight}</p></div>
                                <div><p class="text-xs text-gray-400">Seed Entrópia Est.</p><p class="font-bold">${latentState.seedEntropy}</p></div>
                            </div>
                        </div>
                         <div>
                            <h4 class="font-semibold text-sky-300 mb-2">Audit & Magyarázhatóság</h4>
                             <button id="run-causal-sim" class="w-full bg-indigo-600 text-white font-bold py-2 px-3 rounded-lg btn-hover text-sm hover:bg-indigo-700">Kauzalitás & Oldalcsatorna</button>
                        </div>
                    </div>

                    <!-- Right Column: Decision -->
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-sky-300 mb-2">Ensemble Decision Module</h4>
                            <div class="space-y-2">
                                ${portfolio.map((tip, index) => `
                                <div class="bg-gray-900 rounded-md p-3 ${index === 0 ? 'border border-sky-400' : ''}">
                                    <p class="font-bold text-white">${tip.text}</p>
                                    <div class="text-xs text-sky-300 flex justify-around mt-1">
                                        <span>P: ${probToPercent(tip.prob)}</span>
                                        ${tip.value > 0 ? `<span>Érték: <span class="text-green-400">+${(tip.value*100).toFixed(0)}%</span></span>` : ''}
                                    </div>
                                </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="p-3 bg-gray-600 rounded-lg text-left">
                            <h4 class="font-bold text-gray-300 text-sm mb-2">Eredmény rögzítése</h4>
                            <div class="flex items-center space-x-2">
                                <input type="number" placeholder="H" class="actual-home-score w-16 px-2 py-1 text-sm rounded bg-gray-800 border-gray-500 text-white text-center">
                                <span class="text-gray-400">-</span>
                                <input type="number" placeholder="V" class="actual-away-score w-16 px-2 py-1 text-sm rounded bg-gray-800 border-gray-500 text-white text-center">
                                <button class="save-result-btn ml-auto bg-purple-600 font-semibold py-1 px-3 rounded text-sm btn-hover hover:bg-purple-700">Mentés</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>`;
            
            aiResultDiv.innerHTML = cardHTML;
            
            // Add event listener for the new button
            document.getElementById('run-causal-sim').addEventListener('click', showCausalAnalysis);

        }, 500);
    };
    
    const showCausalAnalysis = () => {
        modalTitle.textContent = "Kauzalitás & Oldalcsatorna Elemzés";
        modalContent.innerHTML = `
            <div class="space-y-4 text-sm">
                <p>A rendszer az oldalcsatorna-adatok (pl. odds frissítési időközök) alapján a következő kauzális kapcsolatot fedezte fel:</p>
                <div class="bg-gray-900 p-3 rounded-lg">
                    <p class="font-semibold text-sky-300">Magas frissítési frekvencia &rarr; Megnövekedett piaci volatilitás &rarr; <span class="text-yellow-400">A 'Twin-A' modell aktiválása</span></p>
                    <p class="text-xs text-gray-400 mt-2">Magyarázat: A gyors és gyakori odds-változások bizonytalan piacra utalnak, ezért a rendszer a magas volatilitásra specializálódott digitális ikertestvért részesíti előnyben a pontosabb előrejelzés érdekében.</p>
                </div>
                <div class="mt-4 border-t border-gray-700 pt-4">
                    <p class="font-semibold">Kalibrációs Réteg Státusza:</p>
                    <p class="text-green-400">OK (Isotonic Regression) - A kimeneti valószínűségek sikeresen kalibrálva.</p>
                </div>
            </div>
        `;
        modalContainer.classList.remove('hidden');
    };

    const showPhilosophy = () => {
        modalTitle.textContent = "DT-MIE Rendszerfilozófia";
        modalContent.innerHTML = `
            <div class="space-y-4 text-sm text-gray-300">
                <div>
                    <h4 class="font-bold text-sky-300 text-base mb-2">Miért Újszerű ez a Megközelítés?</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li><strong class="text-white">Explicit + Generatív + Kauzális Kombináció:</strong> A legtöbb rendszer csak egyféle modellt használ. A DT-MIE hibrid módon ötvözi a statikus, paraméteres modelleket (mint a Dixon-Coles) a modern, generatív AI-val, és ezt kiegészíti egy kauzális, időalapú elemzési réteggel.</li>
                        <li><strong class="text-white">Probilisztikus Rejtett Állapot Modellezés:</strong> Ahelyett, hogy egyetlen "titkos összetevőt" keresnénk, a rendszer a lehetséges rejtett állapotokat (pl. a bukméker belső beállításait) valószínűségi alapon modellezi, ami robusztusabb előrejelzést tesz lehetővé.</li>
                        <li><strong class="text-white">Digital Twin Orchestration:</strong> Több, specializálódott hipotetikus motor ("digitális iker") fut párhuzamosan. A rendszer valós időben választja ki és súlyozza azt, amelyik a legjobban illeszkedik az aktuális piaci környezethez, így dinamikusan adaptálódik.</li>
                        <li><strong class="text-white">Ethical Audit-First Design:</strong> A rendszer alapvető tervezési elve az átláthatóság és az ellenőrizhetőség. Beépített monitoring és automatikus riportálási funkciók biztosítják a működés megfelelőségét.</li>
                    </ul>
                </div>
            </div>
        `;
        modalContainer.classList.remove('hidden');
    };

    // --- INITIALIZATION AND EVENT LISTENERS ---
    loadFromLocalStorage();

    document.querySelectorAll('.ai-input').forEach(input => {
        input.addEventListener('input', () => {
            clearTimeout(analysisTimeout);
            analysisTimeout = setTimeout(runAIAnalysis, 500);
        });
    });
    
    closeModalBtn.addEventListener('click', () => modalContainer.classList.add('hidden'));
    modalContainer.addEventListener('click', (e) => { if (e.target === modalContainer) modalContainer.classList.add('hidden'); });
    openStatsBtn.addEventListener('click', () => { /* Add logic for stats modal */ });
    openPhilosophyBtn.addEventListener('click', showPhilosophy);

});
</script>

</body>
</html>
