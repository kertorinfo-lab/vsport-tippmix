<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odds Minta Elemző</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #e5e7eb; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); }
        .input-field { background-color: #374151; border-color: #4b5563; }
        .input-field:focus { background-color: #4b5563; border-color: #38bdf8; ring: 0; }
        .card { background-color: #1f2937; border: 1px solid #374151; }
        .loader { width: 24px; height: 24px; border: 3px solid #4b5563; border-bottom-color: #38bdf8; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .tab { background-color: #374151; }
        .tab.active { background-color: #1f2937; border-bottom-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="p-4 md:p-8">

    <main class="max-w-6xl mx-auto space-y-8">
        <div>
            <h1 class="text-3xl md:text-4xl font-bold text-sky-400">Odds Minta Elemző</h1>
            <p class="text-slate-400 mt-1">Figyeld meg a mintákat, fedezd fel az összefüggéseket.</p>
        </div>

        <!-- Tab Bar -->
        <div class="flex items-center border-b border-gray-700">
            <div id="tab-bar" class="flex-grow flex items-center -mb-px">
                <!-- Tabs will be injected here -->
            </div>
            <button id="add-tab-btn" class="btn bg-gray-700 hover:bg-gray-600 text-sky-400 font-bold w-8 h-8 rounded-md flex items-center justify-center text-xl ml-2">+</button>
        </div>

        <!-- Tab Content Panels -->
        <div id="tab-content-panels">
            <!-- Content panels will be injected here -->
        </div>

        <!-- Database Section (Global) -->
        <div class="card p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-white">Rögzített Meccsek Adatbázisa</h2>
                <button id="clear-db-btn" class="btn bg-red-800 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg text-xs">Adatbázis Törlése</button>
            </div>
            <div id="log-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                <!-- Log items will be injected here -->
            </div>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- UTILITY FUNCTIONS ---
    const parseSafeFloat = (str) => {
        if (typeof str !== 'string' || str.trim() === '') return NaN;
        return parseFloat(str.replace(',', '.'));
    };

    // --- GLOBAL STATE ---
    let matchLogs = [];
    let tabCounter = 0;
    let activeTabId = null;

    // --- UI ELEMENTS ---
    const elements = {
        tabBar: document.getElementById('tab-bar'),
        addTabBtn: document.getElementById('add-tab-btn'),
        tabContentPanels: document.getElementById('tab-content-panels'),
        clearDbBtn: document.getElementById('clear-db-btn'),
        logList: document.getElementById('log-list'),
    };
    
    // --- DATA MANAGEMENT ---
    const loadData = () => {
        const storedLogs = localStorage.getItem('oddsPatternLogs');
        matchLogs = storedLogs ? JSON.parse(storedLogs) : [];
        renderLogs();
    };

    const saveData = () => {
        localStorage.setItem('oddsPatternLogs', JSON.stringify(matchLogs));
    };

    // --- TAB MANAGEMENT ---
    const createTab = (id) => {
        const tabId = id || ++tabCounter;
        
        const tabButton = document.createElement('button');
        tabButton.className = 'tab text-sm font-semibold py-2 px-4 border border-gray-700 rounded-t-lg flex items-center gap-2';
        tabButton.dataset.tabId = tabId;
        tabButton.innerHTML = `
            <span>Meccs ${tabId}</span>
            <span class="close-tab text-gray-400 hover:text-white">&times;</span>
        `;
        elements.tabBar.appendChild(tabButton);

        const panel = document.createElement('div');
        panel.id = `tab-panel-${tabId}`;
        panel.className = 'tab-content space-y-8';
        panel.dataset.tabId = tabId;
        panel.innerHTML = `
            <div class="card p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4 text-white">1. Adatok Rögzítése</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="text-sm font-medium text-slate-300 mb-2">Csapatok</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" placeholder="Hazai csapat" class="input-field w-full p-2 rounded-lg home-team-input" required>
                            <input type="text" placeholder="Vendég csapat" class="input-field w-full p-2 rounded-lg away-team-input" required>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-slate-300 mb-2">Főpiaci Oddsok (1X2)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="number" step="0.01" min="1" placeholder="Hazai (1)" class="input-field w-full p-2 rounded-lg home-odd-input" required>
                            <input type="number" step="0.01" min="1" placeholder="Döntetlen (X)" class="input-field w-full p-2 rounded-lg draw-odd-input" required>
                            <input type="number" step="0.01" min="1" placeholder="Vendég (2)" class="input-field w-full p-2 rounded-lg away-odd-input" required>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-slate-300 mb-2">További Piacok (Opcionális)</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <input type="number" step="0.01" min="1" placeholder="Over 2.5" class="input-field w-full p-2 rounded-lg over-25-odd-input">
                            <input type="number" step="0.01" min="1" placeholder="Under 2.5" class="input-field w-full p-2 rounded-lg under-25-odd-input">
                            <input type="number" step="0.01" min="1" placeholder="BTTS Igen" class="input-field w-full p-2 rounded-lg btts-yes-odd-input">
                            <input type="number" step="0.01" min="1" placeholder="BTTS Nem" class="input-field w-full p-2 rounded-lg btts-no-odd-input">
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-slate-300 mb-2">Végeredmény</h3>
                        <div class="flex items-center gap-4 flex-wrap">
                            <input type="number" min="0" placeholder="Hazai gól" class="input-field flex-grow p-2 rounded-lg home-score-input" required>
                            <input type="number" min="0" placeholder="Vendég gól" class="input-field flex-grow p-2 rounded-lg away-score-input" required>
                            <button class="btn bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded-lg w-full md:w-auto save-match-btn">Meccs Mentése</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4 text-white">2. Minta Elemzés</h2>
                <p class="text-sm text-slate-400 mb-4">Add meg a csapatnevet és a vizsgálni kívánt oddsokat, majd kattints az elemzés gombra.</p>
                <button class="btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg w-full run-analysis-btn">Elemzés Futtatása</button>
                <div class="mt-6 analysis-output"></div>
            </div>
        `;
        elements.tabContentPanels.appendChild(panel);
        
        switchTab(tabId);
    };

    const switchTab = (tabId) => {
        activeTabId = tabId;
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tabId == tabId));
        document.querySelectorAll('.tab-content').forEach(p => p.classList.toggle('active', p.dataset.tabId == tabId));
    };

    const closeTab = (tabId) => {
        if (document.querySelectorAll('.tab').length <= 1) return;
        const tabToRemove = document.querySelector(`.tab[data-tab-id='${tabId}']`);
        const panelToRemove = document.getElementById(`tab-panel-${tabId}`);
        tabToRemove.remove();
        panelToRemove.remove();
        if (activeTabId === tabId) {
            const lastTab = document.querySelector('.tab:last-of-type');
            if (lastTab) switchTab(parseInt(lastTab.dataset.tabId, 10));
        }
    };
    
    const renderLogs = () => {
        elements.logList.innerHTML = matchLogs.length === 0 
            ? '<p class="text-slate-500 text-center">Nincsenek rögzített meccsek.</p>'
            : matchLogs.map(log => `
                <div class="bg-gray-800 p-3 rounded-lg flex flex-col md:flex-row justify-between items-center gap-2 text-sm">
                    <div class="font-semibold text-white">${log.homeTeam} - ${log.awayTeam}</div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <span class="px-2 py-1 bg-slate-700 rounded">1: <strong>${log.odds.home.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">X: <strong>${log.odds.draw.toFixed(2)}</strong></span>
                        <span class="px-2 py-1 bg-slate-700 rounded">2: <strong>${log.odds.away.toFixed(2)}</strong></span>
                    </div>
                    <div class="text-2xl font-bold text-sky-400">
                        ${log.score.home} - ${log.score.away}
                    </div>
                </div>
            `).join('');
    };

    const handleSaveMatch = (panel) => {
        const homeTeam = panel.querySelector('.home-team-input').value.trim();
        const awayTeam = panel.querySelector('.away-team-input').value.trim();
        const odds = {
            home: parseSafeFloat(panel.querySelector('.home-odd-input').value),
            draw: parseSafeFloat(panel.querySelector('.draw-odd-input').value),
            away: parseSafeFloat(panel.querySelector('.away-odd-input').value),
            over25: parseSafeFloat(panel.querySelector('.over-25-odd-input').value),
            bttsYes: parseSafeFloat(panel.querySelector('.btts-yes-odd-input').value),
        };
        const score = {
            home: parseInt(panel.querySelector('.home-score-input').value, 10),
            away: parseInt(panel.querySelector('.away-score-input').value, 10),
        };

        if (!homeTeam || !awayTeam || isNaN(odds.home) || isNaN(odds.draw) || isNaN(odds.away) || isNaN(score.home) || isNaN(score.away)) {
            alert('Kérlek töltsd ki a kötelező (csapatnév, 1X2 odds, eredmény) mezőket!');
            return;
        }

        matchLogs.unshift({ id: Date.now(), homeTeam, awayTeam, odds, score });
        saveData();
        renderLogs();
        
        panel.querySelector('.home-score-input').value = '';
        panel.querySelector('.away-score-input').value = '';
        alert('Meccs mentve!');
    };

    const handleRunAnalysis = (panel) => {
        const targetHomeTeam = panel.querySelector('.home-team-input').value.trim();
        const targetOdds = {
            home: parseSafeFloat(panel.querySelector('.home-odd-input').value),
            draw: parseSafeFloat(panel.querySelector('.draw-odd-input').value),
            away: parseSafeFloat(panel.querySelector('.away-odd-input').value),
        };
        const analysisOutput = panel.querySelector('.analysis-output');

        if (!targetHomeTeam || isNaN(targetOdds.home) || isNaN(targetOdds.draw) || isNaN(targetOdds.away)) {
            analysisOutput.innerHTML = `<p class="text-yellow-400">Az elemzéshez add meg a hazai csapat nevét és a főpiaci (1X2) oddsokat.</p>`;
            return;
        }
        
        analysisOutput.innerHTML = '<div class="flex justify-center items-center gap-2"><div class="loader"></div><p>Elemzés...</p></div>';

        setTimeout(() => {
            const TOLERANCE = { home: 0.30, draw: 0.70, away: 2.00 };

            const similarMatches = matchLogs.filter(log => {
                const isTeamMatch = log.homeTeam.toLowerCase() === targetHomeTeam.toLowerCase();
                if (!isTeamMatch) return false;

                const isHomeSimilar = Math.abs(log.odds.home - targetOdds.home) <= TOLERANCE.home;
                const isDrawSimilar = Math.abs(log.odds.draw - targetOdds.draw) <= TOLERANCE.draw;
                const isAwaySimilar = Math.abs(log.odds.away - targetOdds.away) <= TOLERANCE.away;
                
                return isHomeSimilar && isDrawSimilar && isAwaySimilar;
            });

            if (similarMatches.length < 1) {
                analysisOutput.innerHTML = `<p class="text-slate-400">Nincs elegendő (min. 1) hasonló meccs az adatbázisban ehhez a csapathoz és odds-konstellációhoz. Találat: ${similarMatches.length} db.</p>`;
                return;
            }

            const stats = {
                total: similarMatches.length, homeWin_Over1_5: 0, homeWin_Under2_5: 0, awayWin_Under2_5: 0,
                homeGoals_1: 0, totalHomeGoals: 0, totalAwayGoals: 0, homeWins3plus: 0
            };

            similarMatches.forEach(match => {
                const totalGoals = match.score.home + match.score.away;
                if (match.score.home > match.score.away) {
                    if (totalGoals > 1.5) stats.homeWin_Over1_5++;
                    if (totalGoals < 2.5) stats.homeWin_Under2_5++;
                    if (match.score.home >= 3) stats.homeWins3plus++;
                }
                if (match.score.home < match.score.away) {
                    if (totalGoals < 2.5) stats.awayWin_Under2_5++;
                }
                if (match.score.home === 1) stats.homeGoals_1++;
                stats.totalHomeGoals += match.score.home;
                stats.totalAwayGoals += match.score.away;
            });
            
            const toPercent = (val) => (val / stats.total) * 100;
            const toAvg = (val) => (val / stats.total).toFixed(2);

            const potentialTips = [
                { text: "Hazai nyer & Több mint 1.5 gól", percent: toPercent(stats.homeWin_Over1_5) },
                { text: "Hazai nyer & Kevesebb mint 2.5 gól", percent: toPercent(stats.homeWin_Under2_5) },
                { text: "Hazai csapat legalább 3 gólt szerez", percent: toPercent(stats.homeWins3plus) },
                { text: "Vendég nyer & Kevesebb mint 2.5 gól", percent: toPercent(stats.awayWin_Under2_5) }
            ];

            const sortedTips = potentialTips.filter(tip => tip.percent > 0).sort((a, b) => b.percent - a.percent);
            const bestTipHTML = sortedTips.length > 0 ? `
                <div class="mt-4 border-t border-gray-700 pt-4">
                    <h4 class="font-semibold text-white text-center">Legvalószínűbb Kimenetel (Tipp)</h4>
                    <div class="bg-sky-900/70 rounded-md p-3 text-center mt-2">
                         <p class="text-lg font-bold text-white">${sortedTips[0].text}</p>
                         <p class="text-sm text-sky-300">Előfordulás: <strong>${sortedTips[0].percent.toFixed(0)}%</strong></p>
                    </div>
                </div>` : '';

            analysisOutput.innerHTML = `
                <div class="space-y-4 p-4 bg-gray-900 rounded-lg">
                    <div class="text-center">
                        <p class="text-sm text-slate-400">Elemzés a(z) <strong class="text-white">${targetHomeTeam}</strong> korábbi meccseire (${stats.total} találat):</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                        <div class="space-y-3">
                             <h4 class="font-semibold text-white">Gyakori Kombinációk</h4>
                             <p class="flex justify-between"><span>Hazai nyer & 1.5 gól felett:</span> <strong>${toPercent(stats.homeWin_Over1_5).toFixed(0)}%</strong></p>
                             <p class="flex justify-between"><span>Hazai nyer & 2.5 gól alatt:</span> <strong>${toPercent(stats.homeWin_Under2_5).toFixed(0)}%</strong></p>
                             <p class="flex justify-between"><span>Vendég nyer & 2.5 gól alatt:</span> <strong class="text-yellow-400">${toPercent(stats.awayWin_Under2_5).toFixed(0)}%</strong></p>
                        </div>
                        <div class="space-y-3">
                             <h4 class="font-semibold text-white">Gól Statisztikák</h4>
                             <p class="flex justify-between"><span>Hazai gólok (átlag):</span> <strong>${toAvg(stats.totalHomeGoals)}</strong></p>
                             <p class="flex justify-between"><span>Hazai 3+ gólt szerez (nyertes meccsen):</span> <strong>${toPercent(stats.homeWins3plus).toFixed(0)}%</strong></p>
                        </div>
                    </div>
                    ${bestTipHTML}
                </div>`;
        }, 500);
    };

    // --- GLOBAL EVENT LISTENERS ---
    elements.addTabBtn.addEventListener('click', () => {
        if(document.querySelectorAll('.tab').length < 5) createTab();
        else alert("Maximum 5 fület nyithatsz meg egyszerre.");
    });

    elements.tabBar.addEventListener('click', (e) => {
        const tabButton = e.target.closest('.tab');
        const closeButton = e.target.closest('.close-tab');
        if (closeButton) {
            e.stopPropagation();
            closeTab(parseInt(tabButton.dataset.tabId, 10));
        } else if (tabButton) {
            switchTab(parseInt(tabButton.dataset.tabId, 10));
        }
    });
    
    elements.tabContentPanels.addEventListener('click', (e) => {
        const panel = e.target.closest('.tab-content');
        if (!panel) return;
        if (e.target.matches('.save-match-btn')) handleSaveMatch(panel);
        else if (e.target.matches('.run-analysis-btn')) handleRunAnalysis(panel);
    });

    elements.clearDbBtn.addEventListener('click', () => {
        if (confirm('Biztosan törölni szeretnéd az összes rögzített meccset?')) {
            matchLogs = [];
            saveData();
            renderLogs();
            document.querySelectorAll('.analysis-output').forEach(el => el.innerHTML = '');
        }
    });

    // --- INITIALIZATION ---
    loadData();
    createTab(1); // Create the first tab on load

});
</script>

</body>
</html>

